<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <link rel="stylesheet" href="/css/styles.css"> <!-- Link to your CSS file -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <%- include("navbar") %> <!-- Include the navbar partial -->

    <div class="container text-center">
        <h1>Quiz</h1>
        <div id="quiz-timer">Time left: <span id="timer"></span></div>
        <form id="quiz-form" method="POST" action="/quiz/submit">
            <div id="quiz-questions">
                <!-- Quiz questions will be dynamically injected here -->
            </div>
            <button type="submit" class="btn btn-primary">Submit Quiz</button>
        </form>
    </div>

    <%- include("footer") %> <!-- Include the footer partial -->

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const timeLimit = 60; // Time limit in seconds
            let timeLeft = timeLimit;
            const timerElement = document.getElementById("timer");

            const updateTimer = () => {
                if (timeLeft <= 0) {
                    document.getElementById("quiz-form").submit();
                } else {
                    timerElement.textContent = timeLeft + " seconds";
                    timeLeft--;
                }
            };

            setInterval(updateTimer, 1000);

            // Fetch quiz questions
            fetch("/quiz")
                .then(response => response.json())
                .then(questions => {
                    const quizQuestions = document.getElementById("quiz-questions");
                    questions.forEach((question, index) => {
                        const questionDiv = document.createElement("div");
                        questionDiv.classList.add("quiz-question", "mb-4");

                        const questionLabel = document.createElement("h5");
                        questionLabel.textContent = question.question;
                        questionDiv.appendChild(questionLabel);

                        question.options.forEach(option => {
                            const optionInput = document.createElement("input");
                            optionInput.type = "radio";
                            optionInput.name = `answers[${question._id}]`;
                            optionInput.value = option;
                            optionInput.required = true;
                            optionInput.classList.add("form-check-input");

                            const optionLabel = document.createElement("label");
                            optionLabel.textContent = option;
                            optionLabel.classList.add("form-check-label");

                            const formCheckDiv = document.createElement("div");
                            formCheckDiv.classList.add("form-check");
                            formCheckDiv.appendChild(optionInput);
                            formCheckDiv.appendChild(optionLabel);

                            questionDiv.appendChild(formCheckDiv);
                        });

                        quizQuestions.appendChild(questionDiv);
                    });
                })
                .catch(error => {
                    console.error("Error fetching quiz questions:", error);
                    const quizQuestions = document.getElementById("quiz-questions");
                    quizQuestions.innerHTML = "<p>Error loading quiz. Please try again later.</p>";
                });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
